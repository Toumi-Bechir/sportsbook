{"ast":null,"code":"import _objectSpread from\"/home/sami/aaa/sportsbook/assets/react/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{Socket}from'phoenix';import SportFilter from'./components/SportFilter';import MatchesList from'./components/MatchesList';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function App(){const[selectedSport,setSelectedSport]=useState('soccer');const[sports,setSports]=useState([]);const[matches,setMatches]=useState([]);const[socket,setSocket]=useState(null);const[connectionStatus,setConnectionStatus]=useState('disconnected');const[lastUpdate,setLastUpdate]=useState(new Date());// Match expansion state\nconst[expandedMatch,setExpandedMatch]=useState(null);const[fullMatchData,setFullMatchData]=useState({});// Market dictionaries cache\nconst[marketDictionaries,setMarketDictionaries]=useState({});// Match events dictionaries cache\nconst[matchEventsDictionaries,setMatchEventsDictionaries]=useState({});// Keep track of active match subscriptions\nconst matchChannelsRef=useRef(new Map());const detailChannelRef=useRef(null);// Initialize socket connection\nuseEffect(()=>{const newSocket=new Socket('/socket',{params:{userToken:'anonymous'}});newSocket.onOpen(()=>{console.log('Socket connected');setConnectionStatus('connected');});newSocket.onError(()=>{console.log('Socket error');setConnectionStatus('error');});newSocket.onClose(()=>{console.log('Socket closed');setConnectionStatus('disconnected');});newSocket.connect();setSocket(newSocket);// Cleanup on unmount\nreturn()=>{if(newSocket){newSocket.disconnect();}};},[]);// Fetch initial sports list\nuseEffect(()=>{fetch('/api/sports').then(response=>response.json()).then(data=>{setSports(data.sports||[]);}).catch(error=>{console.error('Error fetching sports:',error);});},[]);// Fetch market dictionary and match events when sport changes\nuseEffect(()=>{if(!selectedSport)return;// Check if we already have both dictionaries for this sport\nif(marketDictionaries[selectedSport]&&matchEventsDictionaries[selectedSport]){console.log(\"Dictionaries for \".concat(selectedSport,\" already cached\"));return;}console.log(\"Fetching dictionaries for \".concat(selectedSport));fetch(\"/api/markets/\".concat(selectedSport)).then(response=>response.json()).then(data=>{if(data.markets){// Convert markets array to map for faster lookups\nconst marketMap={};data.markets.forEach(market=>{marketMap[market.id]=market.name;});setMarketDictionaries(prev=>_objectSpread(_objectSpread({},prev),{},{[selectedSport]:marketMap}));console.log(\"Cached \".concat(data.markets.length,\" markets for \").concat(selectedSport));}if(data.match_events){// Convert match events array to map for faster lookups\nconst eventsMap={};data.match_events.forEach(event=>{eventsMap[event.code]=event.name;});setMatchEventsDictionaries(prev=>_objectSpread(_objectSpread({},prev),{},{[selectedSport]:eventsMap}));console.log(\"Cached \".concat(data.match_events.length,\" match events for \").concat(selectedSport));}}).catch(error=>{console.error('Error fetching dictionaries:',error);});},[selectedSport,marketDictionaries,matchEventsDictionaries]);// Fetch initial matches when sport changes\nuseEffect(()=>{if(!selectedSport)return;console.log(\"Fetching initial matches for \".concat(selectedSport));fetch(\"/api/matches/\".concat(selectedSport)).then(response=>response.json()).then(data=>{console.log(\"Received initial matches for \".concat(selectedSport,\":\"),data);setMatches(data.matches||[]);setLastUpdate(new Date());}).catch(error=>{console.error('Error fetching matches:',error);setMatches([]);});},[selectedSport]);// Subscribe to individual matches when matches change\nuseEffect(()=>{if(!socket||!selectedSport||matches.length===0)return;console.log(\"Setting up match subscriptions for \".concat(selectedSport));// Clean up existing subscriptions\nmatchChannelsRef.current.forEach((channel,matchId)=>{console.log(\"Leaving subscription for match \".concat(matchId));channel.leave();});matchChannelsRef.current.clear();// Subscribe to each match\nmatches.forEach(league=>{league.matches.forEach(match=>{subscribeToMatch(match.id);});});// Cleanup function\nreturn()=>{matchChannelsRef.current.forEach((channel,matchId)=>{console.log(\"Cleaning up subscription for match \".concat(matchId));channel.leave();});matchChannelsRef.current.clear();};},[socket,selectedSport,matches.length]);// Only re-run when matches count changes\n// Handle expanded match detail subscription\nuseEffect(()=>{if(!socket||!expandedMatch||!selectedSport){// Clean up detail channel if no expanded match\nif(detailChannelRef.current){detailChannelRef.current.leave();detailChannelRef.current=null;}return;}console.log(\"Setting up detail subscription for match \".concat(expandedMatch));// Clean up existing detail channel\nif(detailChannelRef.current){detailChannelRef.current.leave();}// Subscribe to detailed match updates\nconst detailChannel=socket.channel(\"match_details:\".concat(selectedSport,\":\").concat(expandedMatch),{});detailChannel.join().receive('ok',()=>{console.log(\"\\u2705 Successfully subscribed to detailed updates for match \".concat(expandedMatch));}).receive('error',resp=>{console.log(\"\\u274C Failed to subscribe to detailed updates for match \".concat(expandedMatch,\":\"),resp);});// Handle full match data updates\ndetailChannel.on('full_match_data',payload=>{console.log(\"\\uD83D\\uDD04 Full match data for \".concat(expandedMatch,\":\"),payload);setFullMatchData(prev=>_objectSpread(_objectSpread({},prev),{},{[expandedMatch]:payload.data}));setLastUpdate(new Date());});detailChannelRef.current=detailChannel;// Cleanup when expandedMatch changes\nreturn()=>{if(detailChannel){detailChannel.leave();}};},[socket,expandedMatch,selectedSport]);const subscribeToMatch=matchId=>{if(matchChannelsRef.current.has(matchId)){return;// Already subscribed\n}const channelTopic=\"match:\".concat(selectedSport,\":\").concat(matchId);console.log(\"Subscribing to \".concat(channelTopic));const matchChannel=socket.channel(channelTopic,{});matchChannel.join().receive('ok',()=>{console.log(\"\\u2705 Successfully subscribed to match \".concat(matchId));}).receive('error',resp=>{console.log(\"\\u274C Failed to subscribe to match \".concat(matchId,\":\"),resp);});// Handle individual match updates\nmatchChannel.on('match_update',payload=>{console.log(\"\\uD83D\\uDD04 Match \".concat(matchId,\" updated:\"),payload);updateSpecificMatch(matchId,payload.data);});// Store the channel reference\nmatchChannelsRef.current.set(matchId,matchChannel);};// Efficient function to update only a specific match\nconst updateSpecificMatch=(matchId,newData)=>{setMatches(prevMatches=>{return prevMatches.map(league=>{const matchIndex=league.matches.findIndex(m=>m.id===matchId);if(matchIndex===-1)return league;// Match not in this league\n// Create new matches array with updated match\nconst updatedMatches=[...league.matches];updatedMatches[matchIndex]=_objectSpread(_objectSpread({},updatedMatches[matchIndex]),{},{data:newData});return _objectSpread(_objectSpread({},league),{},{matches:updatedMatches});});});setLastUpdate(new Date());};// Handle match toggle\nconst handleToggleMatch=matchId=>{if(expandedMatch===matchId){// Close currently expanded match\nsetExpandedMatch(null);setFullMatchData(prev=>{const newData=_objectSpread({},prev);delete newData[matchId];return newData;});}else{// Open new match (close others automatically)\nsetExpandedMatch(matchId);// Clear previous match data\nsetFullMatchData({});}};const formatTime=seconds=>{if(!seconds)return'00:00';const minutes=Math.floor(seconds/60);const remainingSeconds=seconds%60;return\"\".concat(minutes,\":\").concat(remainingSeconds.toString().padStart(2,'0'));};const getConnectionStatusColor=()=>{switch(connectionStatus){case'connected':return'#10B981';case'error':return'#EF4444';default:return'#6B7280';}};const getTotalMatches=()=>{return matches.reduce((total,league)=>total+league.matches.length,0);};const getLiveMatches=()=>{return matches.reduce((total,league)=>total+league.matches.filter(m=>{var _m$data;return((_m$data=m.data)===null||_m$data===void 0?void 0:_m$data.time)>0;}).length,0);};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen\",style:{backgroundColor:'#003d02'},children:[/*#__PURE__*/_jsx(\"header\",{style:{backgroundColor:'#003d02'},className:\"text-white shadow-lg border-b border-green-900\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-full\",children:[/*#__PURE__*/_jsx(\"div\",{style:{backgroundColor:'#ffb80a'},className:\"text-black py-1 px-4 text-xs text-center font-bold\",children:\"Welcome Bonus - Bet \\xA310 Get \\xA330 in Free Bets\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between py-3 px-4\",style:{borderBottom:'1px solid #1a4f1d'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'#ffb80a'},className:\"font-bold text-2xl\",children:\"bet365\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",style:{backgroundColor:'#1a4f1d'},className:\"px-2 py-1 rounded text-xs\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full animate-pulse\",style:{backgroundColor:getConnectionStatusColor()}}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-300 font-medium\",children:connectionStatus.toUpperCase()})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"hidden md:flex items-center gap-4 text-xs text-gray-300\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 px-2 py-1 rounded\",style:{backgroundColor:'#ff3333'},children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-2 h-2 bg-white rounded-full animate-pulse\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-bold text-white\",children:[getLiveMatches(),\" LIVE\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"px-2 py-1 rounded\",style:{backgroundColor:'#1a4f1d'},children:/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[getTotalMatches(),\" Events\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"px-2 py-1 rounded\",style:{backgroundColor:'#1a4f1d'},children:/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[matchChannelsRef.current.size,\" Feeds\"]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"hidden sm:block text-xs text-gray-400\",children:[\"Last update: \",lastUpdate.toLocaleTimeString()]}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 rounded font-bold text-sm transition-all duration-200 hover:opacity-90\",style:{backgroundColor:'#ffb80a',color:'#003d02'},children:\"JOIN NOW\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-2 rounded text-sm transition-colors hover:opacity-80\",style:{backgroundColor:'#1a4f1d',color:'white'},children:\"LOG IN\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between px-4 py-2\",style:{borderBottom:'1px solid #1a4f1d'},children:[/*#__PURE__*/_jsxs(\"nav\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 text-sm font-bold rounded-t\",style:{backgroundColor:'#ffb80a',color:'#003d02'},children:\"Sports\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 text-sm font-medium transition-colors hover:opacity-80\",style:{backgroundColor:'#1a4f1d',color:'white'},children:\"In-Play\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 text-sm font-medium transition-colors hover:opacity-80\",style:{backgroundColor:'#1a4f1d',color:'white'},children:\"Casino\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 text-sm font-medium transition-colors hover:opacity-80\",style:{backgroundColor:'#1a4f1d',color:'white'},children:\"Live Casino\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 text-sm font-medium transition-colors hover:opacity-80\",style:{backgroundColor:'#1a4f1d',color:'white'},children:\"Games\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 text-xs\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"hover:opacity-80 font-medium\",style:{color:'#ffb80a'},children:\"Live Streaming\"}),/*#__PURE__*/_jsx(\"button\",{className:\"text-gray-300 hover:text-white\",children:\"Mobile\"}),/*#__PURE__*/_jsx(\"button\",{className:\"text-gray-300 hover:text-white\",children:\"Results\"})]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-white shadow-sm\",style:{backgroundColor:'#1a4f1d'},children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-full px-4 py-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-sm font-medium\",children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'#ff3333'},children:\"\\u25CF\"}),/*#__PURE__*/_jsx(\"span\",{children:\"In-Play\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-px h-4 bg-green-700\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 text-sm\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"font-medium hover:opacity-80\",style:{color:'#ffb80a'},children:\"Football\"}),/*#__PURE__*/_jsx(\"button\",{className:\"text-gray-300 hover:text-white\",children:\"Tennis\"}),/*#__PURE__*/_jsx(\"button\",{className:\"text-gray-300 hover:text-white\",children:\"Basketball\"}),/*#__PURE__*/_jsx(\"button\",{className:\"text-gray-300 hover:text-white\",children:\"Ice Hockey\"}),/*#__PURE__*/_jsx(\"button\",{className:\"text-gray-300 hover:text-white\",children:\"Baseball\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 text-xs text-gray-300\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\uD83D\\uDCFA \",getLiveMatches(),\" matches with live streaming\"]}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u26A1 Fast markets\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCB0 Cash Out available\"})]})]})})}),/*#__PURE__*/_jsx(\"main\",{className:\"max-w-full\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-64 shadow-sm\",style:{backgroundColor:'#e8f5e8',borderRight:'1px solid #ccc'},children:/*#__PURE__*/_jsx(SportFilter,{sports:sports,selectedSport:selectedSport,onSportChange:setSelectedSport})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1\",style:{backgroundColor:'#f7f7f7'},children:/*#__PURE__*/_jsx(MatchesList,{sport:selectedSport,matches:matches,formatTime:formatTime,expandedMatch:expandedMatch,onToggleMatch:handleToggleMatch,fullMatchData:fullMatchData,marketDictionary:marketDictionaries[selectedSport]||{},matchEventsDictionary:matchEventsDictionaries[selectedSport]||{}})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-80 shadow-sm\",style:{backgroundColor:'#e8f5e8',borderLeft:'1px solid #ccc'},children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rounded-lg p-4 text-center\",style:{backgroundColor:'#f0f0f0',border:'1px solid #ccc'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-gray-600 mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl mb-2\",children:\"\\uD83C\\uDFAB\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-bold\",children:\"Bet Slip\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mb-3\",children:\"Click on odds to add selections\"}),/*#__PURE__*/_jsx(\"button\",{className:\"w-full py-2 px-4 rounded font-bold transition-colors hover:opacity-90\",style:{backgroundColor:'#ffb80a',color:'#003d02'},children:\"Quick Bet\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 rounded-lg p-4 text-white\",style:{backgroundColor:'#0066cc'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium mb-2\",children:\"\\uD83C\\uDF81 Today's Boost\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs mb-2\",children:\"Enhanced odds on selected matches\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 rounded text-xs font-medium\",style:{backgroundColor:'white',color:'#0066cc'},children:\"View All\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 rounded-lg p-4\",style:{backgroundColor:'#f0f0f0',border:'1px solid #ccc'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-bold text-gray-700 mb-3\",children:\"\\uD83D\\uDCCA Live Stats\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-xs text-gray-600\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Active bets:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-bold\",children:\"1,247,392\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Biggest win today:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-bold\",style:{color:'#009900'},children:\"\\xA389,420\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Popular bet:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-bold\",children:\"Man City Win\"})]})]})]})]})})]})})]});}export default App;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}