{"ast":null,"code":"import _objectSpread from\"/home/sami/aaa/sportsbook/assets/react/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{useParams,useNavigate}from'react-router-dom';import{Socket}from'phoenix';import'./MatchDetailSimple.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function MatchDetailSimple(){var _selectedMatchData$t,_selectedMatch$data,_selectedMatch$data$t,_selectedMatchData$t2,_selectedMatch$data2,_selectedMatch$data2$,_selectedMatch$data3,_selectedMatchData$t3,_selectedMatch$data4,_selectedMatch$data4$,_selectedMatchData$t4,_selectedMatch$data5,_selectedMatch$data5$;const{sport:selectedSport,matchId}=useParams();const navigate=useNavigate();// State management - exactly like the home page\nconst[sports,setSports]=useState([]);const[matches,setMatches]=useState([]);const[socket,setSocket]=useState(null);const[connectionStatus,setConnectionStatus]=useState('disconnected');const[expandedMatch,setExpandedMatch]=useState(null);const[fullMatchData,setFullMatchData]=useState({});const[marketDictionaries,setMarketDictionaries]=useState({});const[matchEventsDictionaries,setMatchEventsDictionaries]=useState({});// Refs for websocket management\nconst matchChannelsRef=useRef(new Map());const detailChannelsRef=useRef(new Map());// Initialize WebSocket - same as home page\nuseEffect(()=>{const newSocket=new Socket('/socket',{params:{userToken:'anonymous'}});newSocket.connect();newSocket.onOpen(()=>{console.log('âœ… WebSocket connected');setConnectionStatus('connected');});newSocket.onError(()=>{console.log('âŒ WebSocket error');setConnectionStatus('error');});newSocket.onClose(()=>{console.log('ðŸ”Œ WebSocket disconnected');setConnectionStatus('disconnected');});setSocket(newSocket);return()=>{matchChannelsRef.current.forEach(channel=>channel.leave());detailChannelsRef.current.forEach(channel=>channel.leave());newSocket.disconnect();};},[]);// Fetch sports data - exactly like home page\nuseEffect(()=>{const fetchSports=async()=>{try{const response=await fetch('/api/sports');const data=await response.json();console.log('ðŸ“Š Sports data:',data);setSports(data.sports||[]);}catch(error){console.error('Error fetching sports:',error);}};fetchSports();},[]);// Fetch matches for selected sport - exactly like home page\nuseEffect(()=>{if(!selectedSport)return;const fetchMatches=async()=>{try{const response=await fetch(\"/api/matches/\".concat(selectedSport));const data=await response.json();console.log(\"\\uD83D\\uDCCA Matches for \".concat(selectedSport,\":\"),data);setMatches(data.matches||[]);}catch(error){console.error(\"Error fetching matches for \".concat(selectedSport,\":\"),error);}};fetchMatches();fetchDictionaries(selectedSport);},[selectedSport]);// Subscribe to match updates - exactly like home page\nuseEffect(()=>{if(!socket||!matches.length||connectionStatus!=='connected')return;console.log(\"\\uD83D\\uDD14 Subscribing to \".concat(matches.length,\" matches for \").concat(selectedSport));matches.forEach(league=>{league.matches.forEach(match=>{subscribeToMatch(selectedSport,match.id);});});return()=>{matchChannelsRef.current.forEach((channel,key)=>{console.log(\"\\uD83D\\uDD0C Unsubscribing from \".concat(key));channel.leave();});matchChannelsRef.current.clear();};},[socket,matches,selectedSport,connectionStatus]);// Auto-expand the selected match\nuseEffect(()=>{if(matches.length>0&&matchId&&!expandedMatch){setExpandedMatch(matchId);}},[matches,matchId,expandedMatch]);const subscribeToMatch=(sport,matchId)=>{const channelKey=\"\".concat(sport,\":\").concat(matchId);if(matchChannelsRef.current.has(channelKey))return;const matchChannel=socket.channel(\"match:\".concat(sport,\":\").concat(matchId),{});matchChannel.join().receive('ok',()=>{console.log(\"\\u2705 Subscribed to match: \".concat(sport,\":\").concat(matchId));}).receive('error',resp=>{console.log(\"\\u274C Failed to subscribe to match: \".concat(sport,\":\").concat(matchId),resp);});matchChannel.on('match_update',payload=>{console.log(\"\\uD83D\\uDD04 Match \".concat(matchId,\" updated:\"),payload);setMatches(prevMatches=>{return prevMatches.map(league=>_objectSpread(_objectSpread({},league),{},{matches:league.matches.map(match=>match.id===matchId?_objectSpread(_objectSpread({},match),{},{data:payload.data}):match)}));});});matchChannelsRef.current.set(channelKey,matchChannel);};const subscribeToMatchDetails=(sport,matchId)=>{const channelKey=\"details:\".concat(sport,\":\").concat(matchId);if(detailChannelsRef.current.has(channelKey))return;const detailChannel=socket.channel(\"match_details:\".concat(sport,\":\").concat(matchId),{});detailChannel.join().receive('ok',()=>{console.log(\"\\u2705 Subscribed to match details: \".concat(sport,\":\").concat(matchId));}).receive('error',resp=>{console.log(\"\\u274C Failed to subscribe to match details: \".concat(sport,\":\").concat(matchId),resp);});detailChannel.on('match_detail_update',payload=>{console.log(\"\\uD83D\\uDCCA Match details updated for \".concat(matchId,\":\"),payload);setFullMatchData(prev=>_objectSpread(_objectSpread({},prev),{},{[matchId]:payload.data}));});detailChannelsRef.current.set(channelKey,detailChannel);};const fetchDictionaries=async sport=>{try{const response=await fetch(\"/api/markets/\".concat(sport));const data=await response.json();if(data.markets){const marketMap={};data.markets.forEach(market=>{marketMap[market.id]=market.name;});setMarketDictionaries(prev=>_objectSpread(_objectSpread({},prev),{},{[sport]:marketMap}));}if(data.match_events){const eventsMap={};data.match_events.forEach(event=>{eventsMap[event.id]=event.name;});setMatchEventsDictionaries(prev=>_objectSpread(_objectSpread({},prev),{},{[sport]:eventsMap}));}}catch(error){console.error('Error fetching dictionaries:',error);}};const handleMatchToggle=matchId=>{if(expandedMatch===matchId){setExpandedMatch(null);// Unsubscribe from details\nconst channelKey=\"details:\".concat(selectedSport,\":\").concat(matchId);const channel=detailChannelsRef.current.get(channelKey);if(channel){channel.leave();detailChannelsRef.current.delete(channelKey);}}else{setExpandedMatch(matchId);subscribeToMatchDetails(selectedSport,matchId);// Navigate to the new match URL\nnavigate(\"/match/\".concat(selectedSport,\"/\").concat(matchId));}};const getMarketName=marketId=>{var _marketDictionaries$s;return((_marketDictionaries$s=marketDictionaries[selectedSport])===null||_marketDictionaries$s===void 0?void 0:_marketDictionaries$s[marketId])||\"Market \".concat(marketId);};const getMatchEventName=eventId=>{var _matchEventsDictionar;return((_matchEventsDictionar=matchEventsDictionaries[selectedSport])===null||_matchEventsDictionar===void 0?void 0:_matchEventsDictionar[eventId])||\"Event \".concat(eventId);};const formatSportName=sport=>{return sport.charAt(0).toUpperCase()+sport.slice(1);};const formatTime=seconds=>{if(!seconds)return'--:--';const mins=Math.floor(seconds/60);const secs=seconds%60;return\"\".concat(mins.toString().padStart(2,'0'),\":\").concat(secs.toString().padStart(2,'0'));};const getScore=matchData=>{var _matchData$t,_matchData$t2;if(!matchData)return'0 - 0';const score1=((_matchData$t=matchData.t1)===null||_matchData$t===void 0?void 0:_matchData$t.score)||0;const score2=((_matchData$t2=matchData.t2)===null||_matchData$t2===void 0?void 0:_matchData$t2.score)||0;return\"\".concat(score1,\" - \").concat(score2);};const getSelectedMatch=()=>{if(!matchId||!matches.length)return null;for(const league of matches){const match=league.matches.find(m=>m.id===matchId);if(match)return match;}return null;};const selectedMatch=getSelectedMatch();const selectedMatchData=fullMatchData[matchId];if(!selectedMatch){return/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading match data...\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/'),children:\"\\u2190 Back to Home\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"match-detail-simple\",children:[/*#__PURE__*/_jsxs(\"aside\",{className:\"matches-sidebar\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back-button\",onClick:()=>navigate('/'),children:\"\\u2190 Back to Home\"}),/*#__PURE__*/_jsxs(\"h2\",{children:[formatSportName(selectedSport),\" Matches\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"matches-list\",children:matches.map((league,leagueIndex)=>/*#__PURE__*/_jsxs(\"div\",{className:\"league-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"league-header\",children:league.league}),league.matches.map(match=>{var _match$data,_match$data$t,_match$data2,_match$data2$t,_match$data3;return/*#__PURE__*/_jsx(\"div\",{className:\"match-card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"match-header\",onClick:()=>handleMatchToggle(match.id),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"teams\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"team-names\",children:[((_match$data=match.data)===null||_match$data===void 0?void 0:(_match$data$t=_match$data.t1)===null||_match$data$t===void 0?void 0:_match$data$t.name)||'Team 1',\" vs \",((_match$data2=match.data)===null||_match$data2===void 0?void 0:(_match$data2$t=_match$data2.t2)===null||_match$data2$t===void 0?void 0:_match$data2$t.name)||'Team 2']}),/*#__PURE__*/_jsxs(\"div\",{className:\"match-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"match-time\",children:formatTime((_match$data3=match.data)===null||_match$data3===void 0?void 0:_match$data3.time)}),/*#__PURE__*/_jsx(\"span\",{className:\"score\",children:getScore(match.data)})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"toggle-button \".concat(match.id===matchId?'expanded':''),children:match.id===matchId?'âˆ’':'+'})]})},match.id);})]},leagueIndex))})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"match-main\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"match-header-main\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"teams-display\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"team-section\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"team-name\",children:(selectedMatchData===null||selectedMatchData===void 0?void 0:(_selectedMatchData$t=selectedMatchData.t1)===null||_selectedMatchData$t===void 0?void 0:_selectedMatchData$t.name)||((_selectedMatch$data=selectedMatch.data)===null||_selectedMatch$data===void 0?void 0:(_selectedMatch$data$t=_selectedMatch$data.t1)===null||_selectedMatch$data$t===void 0?void 0:_selectedMatch$data$t.name)||'Team 1'}),/*#__PURE__*/_jsx(\"div\",{className:\"team-score\",children:(selectedMatchData===null||selectedMatchData===void 0?void 0:(_selectedMatchData$t2=selectedMatchData.t1)===null||_selectedMatchData$t2===void 0?void 0:_selectedMatchData$t2.score)||((_selectedMatch$data2=selectedMatch.data)===null||_selectedMatch$data2===void 0?void 0:(_selectedMatch$data2$=_selectedMatch$data2.t1)===null||_selectedMatch$data2$===void 0?void 0:_selectedMatch$data2$.score)||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"match-status\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"match-time-display\",children:formatTime((selectedMatchData===null||selectedMatchData===void 0?void 0:selectedMatchData.time)||((_selectedMatch$data3=selectedMatch.data)===null||_selectedMatch$data3===void 0?void 0:_selectedMatch$data3.time))}),/*#__PURE__*/_jsx(\"div\",{className:\"vs-text\",children:\"VS\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"team-section\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"team-name\",children:(selectedMatchData===null||selectedMatchData===void 0?void 0:(_selectedMatchData$t3=selectedMatchData.t2)===null||_selectedMatchData$t3===void 0?void 0:_selectedMatchData$t3.name)||((_selectedMatch$data4=selectedMatch.data)===null||_selectedMatch$data4===void 0?void 0:(_selectedMatch$data4$=_selectedMatch$data4.t2)===null||_selectedMatch$data4$===void 0?void 0:_selectedMatch$data4$.name)||'Team 2'}),/*#__PURE__*/_jsx(\"div\",{className:\"team-score\",children:(selectedMatchData===null||selectedMatchData===void 0?void 0:(_selectedMatchData$t4=selectedMatchData.t2)===null||_selectedMatchData$t4===void 0?void 0:_selectedMatchData$t4.score)||((_selectedMatch$data5=selectedMatch.data)===null||_selectedMatch$data5===void 0?void 0:(_selectedMatch$data5$=_selectedMatch$data5.t2)===null||_selectedMatch$data5$===void 0?void 0:_selectedMatch$data5$.score)||0})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"markets-section\",children:selectedMatchData!==null&&selectedMatchData!==void 0&&selectedMatchData.odds&&Array.isArray(selectedMatchData.odds)?/*#__PURE__*/_jsx(\"div\",{className:\"markets-grid\",children:selectedMatchData.odds.map((market,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"market-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"market-header\",children:/*#__PURE__*/_jsxs(\"h3\",{className:\"market-name\",children:[getMarketName(market.id),market.ha&&/*#__PURE__*/_jsxs(\"span\",{className:\"handicap\",children:[\"(\",market.ha,\")\"]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"odds-list\",children:market.o&&Array.isArray(market.o)?market.o.map((odd,oddIndex)=>/*#__PURE__*/_jsxs(\"button\",{className:\"odd-button \".concat(odd.bl===1?'blocked':''),disabled:odd.bl===1,children:[/*#__PURE__*/_jsx(\"span\",{className:\"odd-name\",children:odd.n}),/*#__PURE__*/_jsx(\"span\",{className:\"odd-value\",children:odd.v})]},oddIndex)):/*#__PURE__*/_jsx(\"div\",{className:\"no-odds\",children:\"No odds available\"})})]},index))}):/*#__PURE__*/_jsxs(\"div\",{className:\"loading-markets\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading markets for this match...\"})]})})]}),/*#__PURE__*/_jsxs(\"aside\",{className:\"tracker-sidebar\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tracker-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Live Match Tracker\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"connection-status \".concat(connectionStatus),children:[\"\\u25CF \",connectionStatus]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"match-field\",children:/*#__PURE__*/_jsxs(\"svg\",{className:\"field-svg\",viewBox:\"0 0 400 300\",xmlns:\"http://www.w3.org/2000/svg\",children:[/*#__PURE__*/_jsx(\"rect\",{x:\"0\",y:\"0\",width:\"400\",height:\"300\",fill:\"#4ade80\",stroke:\"#ffffff\",strokeWidth:\"2\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"200\",y1:\"0\",x2:\"200\",y2:\"300\",stroke:\"#ffffff\",strokeWidth:\"2\"}),/*#__PURE__*/_jsx(\"circle\",{cx:\"200\",cy:\"150\",r:\"50\",fill:\"none\",stroke:\"#ffffff\",strokeWidth:\"2\"}),/*#__PURE__*/_jsx(\"rect\",{x:\"0\",y:\"75\",width:\"60\",height:\"150\",fill:\"none\",stroke:\"#ffffff\",strokeWidth:\"2\"}),/*#__PURE__*/_jsx(\"rect\",{x:\"340\",y:\"75\",width:\"60\",height:\"150\",fill:\"none\",stroke:\"#ffffff\",strokeWidth:\"2\"}),/*#__PURE__*/_jsx(\"rect\",{x:\"0\",y:\"112.5\",width:\"20\",height:\"75\",fill:\"none\",stroke:\"#ffffff\",strokeWidth:\"2\"}),/*#__PURE__*/_jsx(\"rect\",{x:\"380\",y:\"112.5\",width:\"20\",height:\"75\",fill:\"none\",stroke:\"#ffffff\",strokeWidth:\"2\"}),/*#__PURE__*/_jsx(\"circle\",{cx:\"200\",cy:\"150\",r:\"6\",fill:\"#fbbf24\",stroke:\"#ffffff\",strokeWidth:\"2\",children:/*#__PURE__*/_jsx(\"animate\",{attributeName:\"r\",values:\"6;8;6\",dur:\"2s\",repeatCount:\"indefinite\"})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"match-events\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Recent Events\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"events-list\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"event-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"event-time\",children:\"45'\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"event-description\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"event-icon\",children:\"\\u26BD\"}),/*#__PURE__*/_jsx(\"span\",{className:\"event-text\",children:\"Goal scored\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"event-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"event-time\",children:\"30'\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"event-description\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"event-icon\",children:\"\\uD83D\\uDFE1\"}),/*#__PURE__*/_jsx(\"span\",{className:\"event-text\",children:\"Yellow card\"})]})]})]})]})]})]});}export default MatchDetailSimple;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}